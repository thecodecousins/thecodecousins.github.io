<!doctype html><html lang=vi><head><title>Thay Ä‘á»•i mÃ¡y chá»§ DNS Ä‘Æ¡n giáº£n báº±ng dÃ²ng lá»‡nh :: thecodecousins â€” Miá»…n lÃ  pháº§n má»m</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="HÆ°á»›ng dáº«n thay Ä‘á»•i mÃ¡y chá»§ DNS nhanh chÃ³ng báº±ng dÃ²ng lá»‡nh Ä‘á»ƒ khÃ´ng bá»‹ cháº·n bá»Ÿi Ä‘iá»ƒm truy cáº­p"><meta name=keywords content=dns,privacy,terminal,bash,network,nameserver><meta name=robots content=noodp><link rel=canonical href=/vi/posts/dns-command/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico><meta name=twitter:card content=summary><meta name=twitter:title content="Thay Ä‘á»•i mÃ¡y chá»§ DNS Ä‘Æ¡n giáº£n báº±ng dÃ²ng lá»‡nh :: thecodecousins â€” Miá»…n lÃ  pháº§n má»m"><meta name=twitter:description content="HÆ°á»›ng dáº«n thay Ä‘á»•i mÃ¡y chá»§ DNS nhanh chÃ³ng báº±ng dÃ²ng lá»‡nh Ä‘á»ƒ khÃ´ng bá»‹ cháº·n bá»Ÿi Ä‘iá»ƒm truy cáº­p"><meta name=twitter:site content=/><meta name=twitter:creator content><meta name=twitter:image content=/posts/dns-command/img/cover.png><meta property=og:locale content=vi><meta property=og:type content=article><meta property=og:title content="Thay Ä‘á»•i mÃ¡y chá»§ DNS Ä‘Æ¡n giáº£n báº±ng dÃ²ng lá»‡nh :: thecodecousins â€” Miá»…n lÃ  pháº§n má»m"><meta property=og:description content="HÆ°á»›ng dáº«n thay Ä‘á»•i mÃ¡y chá»§ DNS nhanh chÃ³ng báº±ng dÃ²ng lá»‡nh Ä‘á»ƒ khÃ´ng bá»‹ cháº·n bá»Ÿi Ä‘iá»ƒm truy cáº­p"><meta property=og:url content=/vi/posts/dns-command/><meta property=og:site_name content="Thay Ä‘á»•i mÃ¡y chá»§ DNS Ä‘Æ¡n giáº£n báº±ng dÃ²ng lá»‡nh"><meta property=og:image content=/posts/dns-command/img/cover.png><meta property=og:image:width content=2048><meta property=og:image:height content=1024><meta property=article:published_time content="2019-10-19 14:53:23.322 &#43;0000 UTC"><link href=/prism-onedark.css rel=stylesheet></head><body class=vi><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=/vi><div class=logo>thecodecousins</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/vi/about>giá»›i thiá»‡u</a></li><li><a href=/vi/contribute>Ä‘Ã³ng gÃ³p</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>viet â–¾</li></ul><ul class="language-selector__more hidden"><li><a href=/>english</a></li><li><a href=/vi/>viet</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/vi/about>giá»›i thiá»‡u</a></li><li><a href=/vi/contribute>Ä‘Ã³ng gÃ³p</a></li><hr><li><a href=/>english</a></li><li><a href=/vi/>viet</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/vi/posts/dns-command/>Thay Ä‘á»•i mÃ¡y chá»§ DNS Ä‘Æ¡n giáº£n báº±ng dÃ²ng lá»‡nh</a></h1><div class=post-meta><span class=post-date>2019-10-19</span>
<span class=post-author>::
<a href=/vi/authors/stanleynguyen/>Stanley Nguyen</a></span></div><span class=post-tags><a href=/vi/tags/dns/>#dns</a>&nbsp;
<a href=/vi/tags/privacy/>#privacy</a>&nbsp;
<a href=/vi/tags/terminal/>#terminal</a>&nbsp;
<a href=/vi/tags/network/>#network</a>&nbsp;</span>
<img src=/posts/dns-command/img/cover.png class=post-cover><div class=post-content><h3 id=bÃ i-toÃ¡n>BÃ i toÃ¡n</h3><p>Táº¥t cáº£ chÃºng ta, á»Ÿ má»™t thá»i Ä‘iá»ƒm nÃ o Ä‘Ã³, Ä‘á»u Ã­t nháº¥t má»™t láº§n thay Ä‘á»•i mÃ¡y chá»§ DNS trÃªn mÃ¡y tÃ­nh.
DÃ¹ lÃ  Ä‘á»ƒ trÃ¡nh kiá»ƒm duyá»‡t, hay tá»‘c Ä‘á»™ truy cáº­p, hay báº£o máº­t, hay Ä‘á»ƒ trÃ¡nh háº¡n cháº¿ ná»™i dung, chÃºng ta Ä‘á»u Ä‘Ã£ tá»«ng thay tÃªn mÃ¡y chá»§ DNS dÃ¹ng mÃ¡y chá»§ cÃ´ng cá»™ng vÃ­ dá»¥ nhÆ° mÃ¡y chá»§ cá»§a Google (cháº¯c báº¡n váº«n nhá»› 8.8.8.8 hay 8.8.4.4 chá»©?)
TÃ´i cÅ©ng khÃ´ng pháº£i lÃ  ngoáº¡i lá»‡, dÃ¹ng <a href=https://1.1.1.1/dns/>1.1.1.1</a> Ä‘á»ƒ báº£o máº­t thÃ´ng tin vÃ  tÄƒng tá»‘c Ä‘á»™ truy cáº­p.
Tuy nhiÃªn, dÃ¹ng nhá»¯ng mÃ¡y chá»§ DNS riÃªng nÃ y Ä‘i cÃ¹ng má»™t sá»‘ háº¡n cháº¿ cho nhá»¯ng ai hay di chuyá»ƒn vÃ  pháº£i dÃ¹ng cÃ¡c máº¡ng truy cáº­p khÃ¡c nhau.
Báº¡n sáº½ nháº­n Ä‘Æ°á»£c cÃ¡i nÃ y náº¿u nhÆ° Ä‘iá»ƒm truy cáº­p mÃ  báº¡n dÃ¹ng cháº·n mÃ¡y chá»§ cá»§a báº¡n</p><p><img src=/posts/dns-command/img/blocked.png alt="blocked by network"></p><p>Má»™t váº¥n Ä‘á» ná»¯a lÃ  báº¡n sáº½ khÃ´ng thá»ƒ vÃ o Ä‘Æ°á»£c trang Ä‘Äƒng nháº­p cá»§a Ä‘iá»ƒm truy cáº­p vá»›i mÃ¡y chá»§ DNS riÃªng.
Táº¥t nhiÃªn lÃ  viá»‡c thay Ä‘á»•i mÃ¡y chá»§ DNS trá»Ÿ láº¡i nhÆ° cÅ© khÃ´ng há» khÃ³ vÃ¬ báº¡n cÃ²n thay Ä‘á»•i Ä‘Æ°á»£c nÃ³ thÃ nh mÃ¡y chá»§ riÃªng cÆ¡ mÃ ?
NhÆ°ng mÃ  náº¿u báº¡n láº¡i cáº§n cÃ¡c mÃ¡y chá»§ áº¥y sau Ä‘Ã³ thÃ¬ sao?
Viá»‡c Ä‘á»•i Ä‘i Ä‘á»•i láº¡i mÃ¡y chá»§ DNS vá»›i tÃ´i quÃ¡ má»‡t má»i nÃªn tÃ´i quyáº¿t Ä‘á»‹nh viáº¿t má»™t cÃ¡i script ngáº¯n báº±ng bash Ä‘á»ƒ khá»i pháº£i tá»± Ä‘á»•i ná»¯a.</p><h3 id=1-1-1-1>1.1.1.1</h3><p>TrÆ°á»›c khi Ä‘i vÃ o pháº§n chÃ­nh, tÃ´i muá»‘n nháº¯c Ä‘áº¿n dá»± Ã¡n tuyá»‡t vá»i nhá» sá»± há»£p tÃ¡c cá»§a <a href=https://www.cloudflare.com/>Cloudflare</a> and <a href=https://www.apnic.net/>APNIC</a> - <a href=https://1.1.1.1/dns/>1.1.1.1</a>.
Dá»± Ã¡n vá»›i má»¥c Ä‘Ã­ch giÃºp cho ngÆ°á»i dÃ¹ng Internet cÃ³ tá»‘c Ä‘á»™ cao hÆ¡n vÃ  báº£o máº­t thÃ´ng tin hÆ¡n (MÃ¡y chá»§ nÃ y nhanh gáº¥p 2 láº§n mÃ¡y chá»§ cá»§a Google ğŸš€ğŸš€ğŸš€).
NhÆ°ng trÃªn háº¿t, nÃ³ Ä‘áº£m báº£o <strong>bÃ­ máº­t thÃ´ng tin tuyá»‡t Ä‘á»‘i</strong>.
Báº¡n nghÄ© ráº±ng chá»‰ cÃ³ nhá»¯ng cÃ´ng ty cÃ´ng nghá»‡ lá»›n nhÆ° Google, Facebook theo dÃµi báº¡n (mÃ  cÃ³ thá»ƒ cháº·n vá»›i <a href=https://www.eff.org/privacybadger>Privacy Badger</a>)?
NhÃ  cung cáº¥p máº¡ng cá»§a báº¡n cÅ©ng theo dÃµi nhÆ°ng trang web mÃ  báº¡n truy cáº­p vÃ  bÃ¡n thÃ´ng tin Ä‘Ã³ cho nhá»¯ng tay quáº£ng cÃ¡o, vÃ  há» lÃ m Ä‘iá»u Ä‘Ã³ báº±ng - khÃ´ng gÃ¬ khÃ¡c ngoÃ i mÃ¡y chá»§ DNS!</p><p>1.1.1.1 báº£o vá»‡ báº¡n khá»i nhá»¯ng má»‘i nguy háº¡i Ä‘Ã³ vá»›i giáº£ chá»‰ 0 Ä‘á»“ng (vÃ¢ng, báº¡n khÃ´ng Ä‘á»c nháº§m Ä‘Ã¢u).
Má»™t mÃ¡y chá»§ DNS <strong>MIá»„N PHÃ</strong>, nhanh, báº£o máº­t - quÃ¡ khÃ³ tin pháº£i khÃ´ng?
Ã nguyá»‡n cá»§a dá»± Ã¡n nÃ y lÃ  Ä‘á»ƒ gÃ¢y dá»±ng má»™t máº¡ng Internet tá»‘t Ä‘áº¹p hÆ¡n.
Báº¡n khÃ´ng cáº§n pháº£i tin suÃ´ng vÃ o lá»i cá»§a mÃ¬nh, Ä‘á»c bÃ i viáº¿t cá»§a <a href=https://blog.cloudflare.com/announcing-1111/>Cloudflare&rsquo;s</a> vÃ  <a href="https://labs.apnic.net/?p=1127">APNIC&rsquo;s</a> vá» nÃ³.</p><h3 id=thay-Ä‘á»•i-mÃ¡y-chá»§-báº±ng-lá»‡nh-bash>Thay Ä‘á»•i mÃ¡y chá»§ báº±ng lá»‡nh bash</h3><p>NhÆ° lÃ  Ä‘Ã£ viáº¿t á»Ÿ trÃªn, viá»‡c thay Ä‘á»•i mÃ¡y chá»§ DNS báº±ng UI CÃ i Äáº·t Máº¡ng lÃ  quÃ¡ phiá»n hÃ  Ä‘á»‘i vá»›i tÃ´i, nháº¥t lÃ  khi cá»© pháº£i chuyá»ƒn qua chuyá»ƒn láº¡i.
NhÆ° thÆ°á»ng lá»‡, nhá»¯ng gÃ¬ quÃ¡ phiá»n hÃ  qua UI thÃ¬ chÃºng ta sáº½ thá»­ lÃ m nÃ³ báº±ng dÃ²ng lá»‡nh.
ÄÃ³ lÃ  khi mÃ  tÃ´i tÃ¬m tháº¥y má»™t á»©ng dá»¥ng terminal ráº¥t há»¯u Ã­ch trÃªn ná»n táº£ng macOS - <code>networksetup</code>.
Vá»›i nÃ³, viá»‡c thay Ä‘á»•i mÃ¡y chá»§ DNS chá»‰ Ä‘Æ¡n giáº£n lÃ </p><pre><code class=language-bash># ThÃªm 1.1.1.1 vÃ o danh sÃ¡ch mÃ¡y chá»§ cá»§a tÃ´i
networksetup -setdnsservers Wi-Fi 1.1.1.1
# XoÃ¡ táº¥t cáº£ cÃ¡c mÃ¡y chá»§ riÃªng
networksetup -setdnsservers Wi-Fi empty
</code></pre><p>Giá» tÃ´i cÃ³ thá»ƒ Ä‘Æ¡n giáº£n thay Ä‘á»•i tÃªn mÃ¡y chá»§ theo hÆ°á»›ng dáº«n trÃªn 1.1.1.1</p><pre><code class=language-bash># 4 mÃ¡y chá»§ - 2 IPv4 &amp; 2 IPv6
networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
</code></pre><p>NhÆ°ng dÃ²ng lá»‡nh nÃ y váº«n quÃ¡ dÃ i Ä‘á»ƒ viáº¿t vÃ  nhá»› (máº·c dÃ¹ váº«n tá»‘t hÆ¡n lÃ  dÃ¹ng UI) nÃªn tÃ´i gÃ³i nÃ³ trong má»™t hÃ m bash</p><pre><code class=language-bash>function dns1111() {
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
}
</code></pre><p>TrÃ´ng nÃ³ cÃ³ váº» khÃ¡ tá»‘t rá»“i pháº£i khÃ´ng? CÆ¡ mÃ  khoan, cÃ²n Ä‘á»•i ngÆ°á»£c láº¡i vá» ban Ä‘áº§u thÃ¬ sao?
Má»™t Ä‘á»‘i sá»‘ cÃ³ láº½ sáº½ khÃ¡ Ä‘Æ¡n giáº£n vÃ  hoÃ n thÃ nh Ä‘Æ°á»£c má»¥c Ä‘Ã­ch nÃ y, nhÆ°ng tÃ´i muá»‘n viáº¿t cÃ ng Ã­t cÃ ng tá»‘t vÃ  khÃ´ng muá»‘n pháº£i nhá»› lÃ  mÃ¬nh Ä‘ang dÃ¹ng mÃ¡y chá»§ DNS nÃ o.
Vá»›i Ã½ nghÄ© Ä‘Ã³, tÃ´i tá»± há»i táº¡i sao mÃ¬nh láº¡i khÃ´ng nháº­n diá»‡n xem lÃ  tÃªn mÃ¡y chá»§ nÃ o Ä‘ang Ä‘Æ°á»£c dÃ¹ng vÃ  thay Ä‘á»•i tuá»³ theo tráº¡ng thÃ¡i Ä‘Ã³?
VÃ  tÃ´i Ä‘Ã£ tÃ¬m tháº¥y lá»±a chá»n nÃ y trong networksetup mÃ  sáº½ thÃ´ng bÃ¡o cho tÃ´i biáº¿t nhá»¯ng mÃ¡y chá»§ Ä‘ang Ä‘Æ°á»£c dÃ¹ng</p><pre><code class=language-bash>networksetup -getdnsservers Wi-Fi
</code></pre><p>NÃ³ sáº½ liá»‡t kÃª Ä‘á»‹a chá»‰ cá»§a cÃ¡c mÃ¡y chá»§ Ä‘ang Ä‘Æ°á»£c dÃ¹ng, hoáº·c lÃ  in ra <code>There aren't any DNS Servers set on Wi-Fi</code> náº¿u khÃ´ng cÃ³ mÃ¡y chá»§ nÃ o.
Giá» tÃ´i cÃ³ thá»ƒ hoÃ n thÃ nh hÃ m cá»§a mÃ¬nh, vá»›i má»™t sá»‘ emojis hiá»ƒn thá»‹ tuá»³ theo cÃ¡c mÃ¡y chá»§ riÃªng vá»«a Ä‘Æ°á»£c cÃ i Ä‘áº·t hay khÃ´ng.</p><pre><code class=language-bash>function dns1111() {
  if [[ $(networksetup -getdnsservers Wi-Fi) == &quot;There aren't any DNS Servers set on Wi-Fi&quot;* ]]; then
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001 &amp;&amp; echo ğŸš€ ğŸš€ ğŸš€
  else
    networksetup -setdnsservers Wi-Fi empty &amp;&amp; echo ğŸš¦ ğŸš¦ ğŸš¦
  fi
}
</code></pre><p>Giá» tÃ´i cÃ³ thá»ƒ Ä‘Æ¡n giáº£n chuyá»ƒn giá»¯a cÃ¡c mÃ¡y chá»§ cá»§a 1.1.1.1 vÃ  mÃ¡y chá»§ máº·c Ä‘á»‹nh chá»‰ vá»›i má»™t cÃ¢u lá»‡nh <code>dns1111</code></p><h3 id=bonus-trÃªn-mÃ¡y-linux>Bonus: TrÃªn mÃ¡y Linux</h3><p>VÃ¬ <code>networksetup</code> khÃ´ng cÃ³ trÃªn cÃ¡c há»‡ Ä‘iá»u hÃ nh thuá»™c gia Ä‘Ã¬nh Linux, chÃºng ta sáº½ cáº§n dÃ¹ng má»™t á»©ng dá»¥ng khÃ¡c Ä‘á»ƒ thiáº¿t láº­p cÃ¡c mÃ¡y chá»§ - <code>dnsmasq</code>.</p><p>CÃ i nÃ³ báº±ng package manager cá»§a báº¡n</p><pre><code class=language-bash># cÃ i nÃ y dÃ¹ng trÃªn Ubuntu
sudo apt-get install dnsmasq
</code></pre><p>CÃ i gÃ³i nÃ y sáº½ cho chÃºng ta má»™t config file <code>/etc/dnsmasq.conf</code> mÃ  cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ thay Ä‘á»•i mÃ¡y chá»§ DNS.
TÃ´i viáº¿t <code>dns1111</code> cho cÃ¡c há»‡ Ä‘iá»u hÃ nh Linux nhÆ° dÆ°á»›i Ä‘Ã¢y.
Náº¿u báº¡n nghÄ© cÃ¡ch lÃ m nÃ y chÆ°a pháº£i lÃ  tá»‘i Æ°u nháº¥t, hÃ£y liÃªn láº¡c ngay vá»›i tÃ´i qua <a href=mailto:hung.ngn.the@gmail.com>hung.ngn.the@gmail.com</a></p><pre><code class=language-bash>function dns1111() {
  # xÃ¡c Ä‘á»‹nh xem lÃ  cÃ³ file backup nÃ o khÃ´ng Ä‘á»ƒ nháº­n Ä‘á»‹nh lÃ  mÃ¡y chá»§ riÃªng
  # Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t hay chÆ°a
  if [[ -f /etc/dnsmasq.conf.bak ]]; then
    sudo mv /etc/dnsmasq.conf.bak /etc/dnsmasq.conf &amp;&amp; echo ğŸš¦ ğŸš¦ ğŸš¦
  else
    sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak &amp;&amp; \
    sudo echo -e &quot;server=1.1.1.1\nserver=1.0.0.1\nserver=2606:4700:4700::1111\nserver=2606:4700:4700::1001&quot; &gt;&gt; /etc/dnsmasq.conf &amp;&amp; \
    sudo systemctl restart dnsmasq  &amp;&amp; \
    sudo systemctl restart NetworkManager  &amp;&amp; \
    echo ğŸš€ ğŸš€ ğŸš€
  fi
}
</code></pre><p><strong>Kiá»ƒm tra</strong>
Äá»ƒ thá»±c hiá»‡n kiá»ƒm tra tá»‘c Ä‘á»™ tra cá»©u, hÃ£y chá»n má»™t trang web chÆ°a Ä‘Æ°á»£c truy cáº­p ká»ƒ tá»« khi báº¡n báº¯t Ä‘áº§u cháº¡y dnsmasq (<code>drill</code> lÃ  má»™t pháº§n cá»§a gÃ³i <code>ldns</code>):</p><pre><code class=language-bash>$ drill archlinux.org | grep &quot;Query time&quot;
</code></pre><p>Cháº¡y láº¡i lá»‡nh sáº½ sá»­ dá»¥ng IP DNS Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache vÃ  káº¿t quáº£ lÃ  thá»i gian tra cá»©u nhanh hÆ¡n náº¿u dnsmasq Ä‘Æ°á»£c thiáº¿t láº­p chÃ­nh xÃ¡c:</p><pre><code class=language-bash>$ drill archlinux.org | grep &quot;Query time&quot;

;; Query time: 18 msec

$ drill archlinux.org | grep &quot;Query time&quot;

;; Query time: 2 msec
</code></pre></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Ä‘á»c bÃ i khÃ¡c</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/vi/posts/example/><span class=button__text>BÃ i viáº¿t vÃ­ dá»¥</span>
<span class=button__icon>â†’</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>